name: Ruff Auto Fix

on:
  pull_request:  # í…ŒìŠ¤íŠ¸ìš© ì„ì‹œ ì¶”ê°€
  workflow_dispatch:
    inputs:
      branch:
        description: 'Target branch to run Ruff fix on'
        required: true
        type: string
      base_branch:
        description: 'Base branch for PR'
        required: false
        default: 'dev'
        type: string
      issue_number:
        description: 'Related issue number'
        required: true
        type: string

permissions:
  contents: write
  pull-requests: write
  security-events: write
  actions: read

jobs:
  ruff-fix:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        # with:
        #   ref: ${{ inputs.branch }}
        #   fetch-depth: 0

      - name: Install uv
        uses: astral-sh/setup-uv@v4
        with:
          version: "latest"

      - name: Install Ruff
        run: uv tool install ruff

      - name: Run Ruff Fix
        run: |
          ruff check --fix . || true
          ruff format . || true

      - name: Run Ruff Check (SARIF)
        run: ruff check --output-format=sarif --output-file=ruff-results.sarif . || true

      - name: Upload SARIF to GitHub
        uses: github/codeql-action/upload-sarif@v4
        with:
          sarif_file: ruff-results.sarif
          category: ruff

      # í…ŒìŠ¤íŠ¸ìš© ì£¼ì„ ì²˜ë¦¬ - ì•„ë˜ëŠ” workflow_dispatchì—ì„œë§Œ ì‚¬ìš©
      # - name: Check for changes
      #   id: changes
      #   run: |
      #     if [[ -n $(git status --porcelain) ]]; then
      #       echo "has_changes=true" >> $GITHUB_OUTPUT
      #     else
      #       echo "has_changes=false" >> $GITHUB_OUTPUT
      #     fi

      # - name: Commit and Push changes
      #   if: steps.changes.outputs.has_changes == 'true'
      #   run: |
      #     git config --local user.email "github-actions[bot]@users.noreply.github.com"
      #     git config --local user.name "github-actions[bot]"
      #     git add -A
      #     git commit -m "style: auto-fix with ruff
      #
      #     ğŸ¤– Generated by GitHub Actions"
      #     git push

      # - name: Create Pull Request
      #   if: steps.changes.outputs.has_changes == 'true'
      #   env:
      #     GH_TOKEN: ${{ github.token }}
      #     BRANCH: ${{ inputs.branch }}
      #     BASE_BRANCH: ${{ inputs.base_branch }}
      #     ISSUE_NUMBER: ${{ inputs.issue_number }}
      #   run: |
      #     gh pr create \
      #       --title "[FIX] Ruff auto-fix for #${ISSUE_NUMBER}" \
      #       --body "## Summary
      #     - Ruffë¥¼ ì‚¬ìš©í•˜ì—¬ ì½”ë“œ ìŠ¤íƒ€ì¼ ìë™ ìˆ˜ì •
      #
      #     ## Related Issue
      #     Closes #${ISSUE_NUMBER}
      #
      #     ## Changes
      #     - \`ruff check --fix\` ì ìš©
      #     - \`ruff format\` ì ìš©
      #
      #     ---
      #     ğŸ¤– Generated by GitHub Actions" \
      #       --base "${BASE_BRANCH}" \
      #       --head "${BRANCH}"

      # - name: No changes detected
      #   if: steps.changes.outputs.has_changes == 'false'
      #   run: echo "No changes detected. Skipping PR creation."
